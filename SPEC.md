# llminfo-cli - 仕様書

## 概要
OpenRouter.aiおよび関連AIプロバイダー（Groq、Cerebras、Mistral）の利用可能なLLMモデル情報を取得・検索するCLIツール

## ユーザーニーズ

### 必須機能
1. **クレジット残高確認** - 各プロバイダーの残クレジットを表示（対応プロバイダーのみ）
2. **プロバイダー管理** - 設定ファイルベースでプロバイダーを追加・管理
3. **プロバイダーテスト** - 新規プロバイダー設定をテストする機能

### 機能削除（履歴）
以下の機能は当初計画されていましたが、実際の利用シーンにおいて必要性が低いと判断され削除されました：
- **Freeモデル一覧表示** - Free判定がプロバイダー間で統一されていないため削除
- **最適Freeモデル選択** - 上記に伴い削除

### 利用想定
- 環境変数 `OPENROUTER_API_KEY` にAPIキーを設定済み
- AgentCodingToolからプログラム的に呼び出される想定
- シェルスクリプトとしても利用可能

## 対応プロバイダー

| プロバイダー | ベースURL | APIキー環境変数 | モデル一覧 | クレジット |
|------------|-----------|----------------|---------|--------|
| OpenRouter | https://openrouter.ai/api/v1 | OPENROUTER_API_KEY | o | o |
| Groq | https://api.groq.com/openai/v1 | GROQ_API_KEY | o | x |
| Cerebras | https://api.cerebras.ai/v1 | CEREBRAS_API_KEY | o | x |
| Mistral | https://api.mistral.ai/v1 | MISTRAL_API_KEY | o | x |

## 要件定義

### FR-001: クレジット残高確認
- 各プロバイダーの残クレジットを表示する（OpenRouter等）
- 総購入額、総使用額、残高を表示
- 未対応のプロバイダーはエラーを返す

### FR-002: プロバイダー管理
- 設定ファイル（providers.yml）でプロバイダーを管理
- OpenAI互換プロバイダーは設定ファイルのみで追加可能
- OpenRouter等はカスタムパーサーを使用

### FR-003: プロバイダーテスト

テスト用の新しいプロバイダー設定をテストする機能（test-provider コマンド）
- テスト成功後、永続的な設定に追加する機能（import-provider コマンド）
- 設定ファイルのバリデーション（必須フィールド、URL形式、パーサータイプ、api_key_env 大文字）
- キャッシュの無効化 (--force フラグ)

### FR-004: プロバイダー指定
- コマンドラインでプロバイダーを指定可能にする
- デフォルト：openrouter

### FR-005: キャッシュ機能
- モデルリストを 1 時間キャッシュする機能
- キャッシュ場所: `~/.cache/llminfo/`
- デフォルトでキャッシュを使用、`--force` フラグで無効化
- TTL 期限切れで自動的にキャッシュを無効化

## 非機能要望

| ID | 要望 | 優先度 |
|----|--------|---------|
| NF-001 | 複数プロバイダーの料金比較 | Low |
| NF-002 | モデル詳細情報の表示 | Low |
| NF-003 | モデルフィルタリング（名前、価格など） | Medium |
| NF-004 | モデル検索機能 | Medium |
| NF-005 | プラグインシステム拡張（カスタムパーサー） | Low |

## 技術制約

- Python 3.11+
- インターネット接続必須
- APIキー認証必須
- レート制限に準拠
- プロバイダー設定はYAML形式で記述
- OpenAI互換プロバイダーは設定ファイルのみで追加可能

## プロバイダー追加基準

### 設定ファイルのみで追加可能（OpenAI互換）
以下の全てを満たすプロバイダー：
1. OpenAI互換API（Base URL + `/models` エンドポイント）
2. APIキー認証: `Authorization: Bearer <token>`
3. レスポンス構造: `{"data": [...]}` または単純な配列
4. 標準HTTPステータスコード（200, 401, 429）

### カスタム実装が必要
以下のいずれかを満たすプロバイダー：
1. カスタム認証（ヘッダー名が異なる、署名が必要）
2. モデル情報がネストした構造
3. 課金情報に複雑な変換が必要
4. ページネーションや特殊なパラメータが必要

## セキュリティ要件

- APIキーは環境変数のみに保存（設定ファイルには環境変数名のみ）
- プラグインファイル（plugin/*.yml）は.gitignoreで管理
- ログファイルにはAPIキーを含めない
- HTTPS通信のみ使用

## 運用環境

- 開発環境: ローカル開発
- 実行環境: Python 3.11+がインストール済みのマシン

## 配布形式

- PyPIパッケージとして配布
- インストール: `pip install llminfo-cli`
