# 概要: LLM協働開発のための設計思想

このドキュメントは、人間とLLM（大規模言語モデル）が協働してソフトウェアを開発する際の設計フィロソフィーを定義したものです。
ここでのドキュメントやコードベースは、単なる記録ではなく、**AIエージェントへの入力コンテキスト（システムプロンプト）**として機能します。

## 1. コア・フィロソフィー: "Codebase as Context"

LLMとの協働において、プロジェクト構造の明確さはAIの出力品質に直結します。
**「設計の曖昧さは、コードの幻覚（ハルシネーション）を生む」** という原則を常に意識してください。

### 1.1 システムプロンプトとしてのドキュメント
LLMの推論を安定させるために、以下の2つのドキュメントを「アンカー（碇）」として利用します。

- **`SPEC.md` (The "What")**:
    - **役割**: 実装すべき機能の「正解」を定義する。
    - **LLMへの影響**: ここに書かれていない要件をLLMは「推測」で埋めようとし、バグの温床となります。
    - **ルール**: 複雑な機能を実装させる前に、必ずこのファイルを更新する。

- **`BLUEPRINT.md` (The "How")**:
    - **役割**: 技術選定、アーキテクチャ、制約条件を定義する。
    - **LLMへの影響**: AIがプロジェクトとかけ離れたライブラリやパターンを使用するのを防ぎます。
    - **ルール**: ディレクトリ構造や使用するライブラリを明示的にリストアップし、探索空間を限定する。

### 1.2 コンテキストウィンドウを意識したモジュール設計
LLMの記憶容量（コンテキストウィンドウ）には限りがあります。

- **Small Context Principle**:
    - ファイルは「単一責任の原則」に従って小さく保つ。
    - 巨大な1つのファイルよりも、明確に分割された小さなファイル群の方が、LLMは正確に修正できます。
- **明確なインターフェース**:
    - モジュール間の境界（Interface/Type Definition）を明確にする。
    - これにより、LLMに対して「インターフェース定義」だけを与えて「実装」を行わせるといった、トークン効率の良い作業が可能になります。

## 2. テンプレートと具体例

LLMに渡すドキュメントの具体例です。

### 例: `SPEC.md` (要件定義)
機能ID（FR-XXX）を振ることで、コミットログやチャットでの参照性を高めます。

```markdown
## FR-001: 天気予報取得機能

### 概要
ユーザーが指定した都市の現在の天気を取得し、表示する。

### ユーザー入力
- 引数: `--city` (文字列, 必須)
- オプション: `--json` (フラグ, JSON形式で出力)

### 期待される挙動
1. 外部API (WeatherAPI) を叩く。
2. 成功時: 都市名、温度、天気概況を表示。
3. 失敗時: "City not found" エラーを表示し、終了コード1を返す。

### 制約事項
- APIキーは環境変数 `WEATHER_API_KEY` から読み込むこと。
```

### 例: `BLUEPRINT.md` (技術設計)
言語やスタックに依存した具体的な実装方針をここに記述します。

```markdown
## 技術スタック (Python CLI版)
- **CLIフレームワーク**: `Typer`
- **HTTPクライアント**: `httpx` (非同期)
- **設定管理**: `pydantic-settings`

## アーキテクチャ
- `src/main.py`: エントリーポイント。引数解析のみ行う。
- `src/core/weather.py`: ビジネスロジック。純粋なPython関数。
- `src/adapters/api.py`: 外部APIとの通信。

## 将来の拡張 (Go Server版)
- **Webフレームワーク**: `Echo` or `Gin`
- **構成**: Clean Architecture (Handler -> Usecase -> Repository)
```

## 3. インタラクティブな要件定義プロセス (Hearing & Refinement)

人間がいきなり完璧な仕様書やテストコードを書くのは困難です。
AIエージェントの役割は、単に実装することだけでなく、**「人間から曖昧さを取り除く質問をする」**ことでもあります。

### 3.1 要件定義のヒアリング・ループ
1. **Human**: 「こういう機能が欲しい」と自然言語で投げる。
2. **AI**: 不足している情報（エッジケース、エラー時の挙動、制約）を人間に質問する。
    - *「入力が空の場合はどうしますか？」*
    - *「API制限に達した際のリトライ戦略は？」*
3. **Refinement**: 会話を通じて `SPEC.md` を更新・確定させる。

### 3.2 テストケースの抽出
実装前に、AIは仕様から「テストすべきシナリオ」をリストアップし、人間に確認を求めます。
このリストが承認されて初めて、テストコードの実装に移ります。

## 4. プロジェクト規模と拡張性 (Scalability)

このガイドラインは、Python CLIだけでなく、Webサービスや他言語（Golang等）への展開も想定しています。

### Phase 1: CLIツール / プロトタイプ
- **対象**: Python CLI, シェルスクリプト
- **構成**: シンプルな `MVC` (Model-View-Controller) または `Main + Lib` 構成。
- **ドキュメント**: `SPEC.md` に全機能を記述。

### Phase 2: Webサービス / APIサーバー
- **対象**: Python (FastAPI), Go (Echo)
- **構成**: レイヤードアーキテクチャ、またはオニオンアーキテクチャ。
- **拡張**: `docs/` 下に `api_spec.yaml` (OpenAPI) や `db_schema.md` を追加し、ドキュメントを分割管理する。

### Phase 3: マイクロサービス / マルチ言語
- **対象**: Python (Data Science) + Go (High Performance API)
- **構成**: リポジトリ分割、またはMonorepo構成。
- **共通化**: `Taskfile.yml` を統一インターフェースとして維持し、言語の違いをタスクランナーで吸収する。
